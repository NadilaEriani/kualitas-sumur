<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Peta ‚Ä¢ SIG Kualitas Air Sumur</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.awesome-markers@2.0.5/dist/leaflet.awesome-markers.css"
    />

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.awesome-markers@2.0.5/dist/leaflet.awesome-markers.js"></script>

    <script defer src="ui.js"></script>
  </head>

  <body class="map-page">
    <header class="topnav">
      <div class="topnav-inner">
        <a class="nav-brand" href="index.html">
          <span class="nav-mark"><i class="fa-solid fa-water"></i></span>
          <span class="nav-title">SIG Air Sumur</span>
          <span class="nav-sub">3 Kecamatan Pekanbaru</span>
        </a>

        <nav class="nav-links" aria-label="Navigasi utama">
          <a class="nav-link" href="index.html">
            <i class="fa-solid fa-house"></i> Home
          </a>
          <a class="nav-link active" href="map.html">
            <i class="fa-solid fa-map-location-dot"></i> Maps
          </a>
          <a class="nav-link" href="data.html">
            <i class="fa-solid fa-database"></i> Database
          </a>
          <a class="nav-link" href="analytics.html">
            <i class="fa-solid fa-chart-line"></i> Statistika
          </a>
        </nav>

        <div class="nav-actions">
          <button class="nav-btn theme-toggle" type="button" data-theme-toggle>
            <i class="fa-solid fa-moon"></i><span>Dark</span>
          </button>
          <a class="nav-btn primary" href="data.html">
            <i class="fa-solid fa-database"></i> Kelola Data
          </a>
        </div>
      </div>
    </header>

    <aside id="sidebar">
      <div class="sidebar-top">
        <h2><i class="fa-solid fa-chart-column"></i> Dashboard SIG</h2>
        <div class="subtitle">3 Kecamatan Pekanbaru</div>

        <div class="sidebar-search">
          <label class="muted" for="map-search" style="font-size: 12px"
            >Search lokasi / kecamatan / id_sumur</label
          >
          <input
            id="map-search"
            class="input"
            placeholder="cth: AS036 / Payung Sekaki"
            autocomplete="off"
          />
        </div>

        <div class="quick-actions">
          <button class="btn" id="btn-reset-view" type="button">
            <i class="fa-solid fa-arrows-rotate"></i> Reset View
          </button>
          <button class="btn" id="btn-locate" type="button">
            <i class="fa-solid fa-location-crosshairs"></i> Lokasi Saya
          </button>
          <button class="btn primary" id="btn-export-filtered" type="button">
            <i class="fa-solid fa-file-export"></i> Export CSV
          </button>
          <button class="btn" id="btn-clear-search" type="button">
            <i class="fa-solid fa-eraser"></i> Clear
          </button>
        </div>

        <div class="muted" style="margin-top: 10px; font-size: 12.5px">
          Menampilkan <b><span id="filter-count">0</span></b> titik (hasil
          filter)
        </div>
      </div>

      <div class="tabs" role="tablist" aria-label="Panel Sidebar">
        <button class="tab-btn active" data-tab="stat" type="button">
          Statistik
        </button>
        <button class="tab-btn" data-tab="layer" type="button">Layer</button>
        <button class="tab-btn" data-tab="filter" type="button">Filter</button>
        <button class="tab-btn" data-tab="legend" type="button">Legenda</button>
      </div>

      <div class="tab-panels">
        <section class="map-card" data-panel="stat">
          <h3><i class="fa-solid fa-droplet"></i> Statistik Dataset</h3>
          <div class="stat-row">
            <span>Total Sumur</span><b id="total-sumur">0</b>
          </div>
          <div class="stat-row">
            <span>Sumur Bor</span><b id="count-bor">0</b>
          </div>
          <div class="stat-row">
            <span>Sumur Gali</span><b id="count-gali">0</b>
          </div>
        </section>

        <section class="map-card hidden" data-panel="layer">
          <h3><i class="fa-solid fa-layer-group"></i> Layer Peta</h3>

          <label class="switch-row">
            <span
              ><i class="fa-solid fa-draw-polygon"></i> Wilayah Administrasi
              Riau</span
            >
            <label class="switch">
              <input type="checkbox" id="togglePolygon" checked />
              <span class="slider"></span>
            </label>
          </label>

          <label class="switch-row">
            <span><i class="fa-solid fa-border-all"></i> Batas Wilayah</span>
            <label class="switch">
              <input type="checkbox" id="toggleBoundary" checked />
              <span class="slider"></span>
            </label>
          </label>

          <h3 style="margin-top: 12px">
            <i class="fa-solid fa-droplet"></i> Jenis Sumur
          </h3>

          <label class="switch-row">
            <span> <span class="dot blue"></span> Sumur Bor </span>
            <label class="switch">
              <input type="checkbox" id="toggleBor" checked />
              <span class="slider"></span>
            </label>
          </label>

          <label class="switch-row">
            <span> <span class="dot teal"></span> Sumur Gali </span>
            <label class="switch">
              <input type="checkbox" id="toggleGali" checked />
              <span class="slider"></span>
            </label>
          </label>

          <h3 style="margin-top: 12px">
            <i class="fa-solid fa-triangle-exclamation"></i> Risiko Pencemaran
          </h3>

          <label class="switch-row">
            <span> <span class="dot red"></span> Risiko Tinggi </span>
            <label class="switch">
              <input type="checkbox" id="toggleRiskHigh" checked />
              <span class="slider"></span>
            </label>
          </label>

          <label class="switch-row">
            <span> <span class="dot yellow"></span> Risiko Sedang </span>
            <label class="switch">
              <input type="checkbox" id="toggleRiskMedium" checked />
              <span class="slider"></span>
            </label>
          </label>

          <label class="switch-row">
            <span> <span class="dot green"></span> Risiko Rendah </span>
            <label class="switch">
              <input type="checkbox" id="toggleRiskLow" checked />
              <span class="slider"></span>
            </label>
          </label>
        </section>

        <section class="map-card hidden" data-panel="filter" id="filter-card">
          <h3><i class="fa-solid fa-filter"></i> Filter pH & Jarak</h3>

          <div class="filter-grid">
            <div class="fg">
              <label for="filter-ph-min">pH Min</label>
              <input
                id="filter-ph-min"
                class="input"
                type="number"
                step="0.1"
                placeholder="cth: 6.5"
              />
            </div>

            <div class="fg">
              <label for="filter-ph-max">pH Max</label>
              <input
                id="filter-ph-max"
                class="input"
                type="number"
                step="0.1"
                placeholder="cth: 8.0"
              />
            </div>

            <div class="fg">
              <label for="filter-septic-min">Septic Min (m)</label>
              <input
                id="filter-septic-min"
                class="input"
                type="number"
                step="1"
                placeholder="cth: 5"
              />
            </div>

            <div class="fg">
              <label for="filter-septic-max">Septic Max (m)</label>
              <input
                id="filter-septic-max"
                class="input"
                type="number"
                step="1"
                placeholder="cth: 30"
              />
            </div>

            <div class="fg">
              <label for="filter-selokan-min">Selokan Min (m)</label>
              <input
                id="filter-selokan-min"
                class="input"
                type="number"
                step="1"
                placeholder="cth: 5"
              />
            </div>

            <div class="fg">
              <label for="filter-selokan-max">Selokan Max (m)</label>
              <input
                id="filter-selokan-max"
                class="input"
                type="number"
                step="1"
                placeholder="cth: 30"
              />
            </div>
          </div>

          <div class="filter-actions">
            <button
              type="button"
              id="btn-apply-filter"
              class="btn-filter primary"
            >
              Terapkan
            </button>
            <button type="button" id="btn-reset-filter" class="btn-filter">
              Reset
            </button>
          </div>

          <div class="filter-result">
            Tips: fokus ke titik yang <b>dekat septic/selokan</b>.
          </div>
          <hr class="filter-divider" />

          <h3 style="margin: 10px 0 8px">
            <i class="fa-solid fa-bullseye"></i> Zona Radius
          </h3>

          <div class="filter-grid">
            <div class="fg" style="grid-column: 1 / -1">
              <label class="switch-row" style="padding: 10px 0">
                <span
                  ><i class="fa-solid fa-circle zone-dot zone-dot--septic"></i>
                  Tampilkan Zona Septic</span
                >

                <label class="switch">
                  <input type="checkbox" id="zone-septic-on" />
                  <span class="slider"></span>
                </label>
              </label>

              <label class="switch-row" style="padding: 10px 0">
                <span
                  ><i class="fa-solid fa-circle zone-dot zone-dot--selokan"></i>
                  Tampilkan Zona Selokan</span
                >

                <label class="switch">
                  <input type="checkbox" id="zone-selokan-on" />
                  <span class="slider"></span>
                </label>
              </label>
            </div>

            <div class="fg">
              <label for="zone-scale">Skala Radius</label>
              <select id="zone-scale" class="input">
                <option value="0.5">0.5x (lebih kecil)</option>
                <option value="1" selected>1x (asli)</option>
                <option value="1.5">1.5x</option>
                <option value="2">2x</option>
                <option value="3">3x</option>
              </select>
            </div>

            <div class="fg">
              <label for="zone-max">Batas Maks Radius (m)</label>
              <input
                id="zone-max"
                class="input"
                type="number"
                step="10"
                placeholder="cth: 200"
              />
            </div>
          </div>

          <div class="muted" style="margin-top: 8px; font-size: 12.5px">
            Zona radius dihitung dari nilai <b>jarak septic</b> &
            <b>jarak selokan</b>
            pada data. Skala mengalikan radius, batas maks membatasi lingkaran
            agar tidak terlalu besar.
          </div>
        </section>

        <section class="map-card hidden" data-panel="legend">
          <h3><i class="fa-solid fa-circle-info"></i> Legenda</h3>
          <div class="muted" style="font-size: 13px">
            Warna lingkaran menunjukkan risiko pencemaran.
          </div>

          <div style="margin-top: 12px; display: grid; gap: 10px">
            <div class="switch-row" style="justify-content: flex-start">
              <span class="dot red"></span><span>Risiko Tinggi</span>
            </div>
            <div class="switch-row" style="justify-content: flex-start">
              <span class="dot yellow"></span><span>Risiko Sedang</span>
            </div>
            <div class="switch-row" style="justify-content: flex-start">
              <span class="dot green"></span><span>Risiko Rendah</span>
            </div>

            <div class="muted" style="margin-top: 6px; font-size: 13px">
              Marker menunjukkan jenis sumur (bor/gali). Klik titik untuk detail
              & tombol buka koordinat di Google Maps.
            </div>
          </div>
        </section>
      </div>
    </aside>

    <div id="basemap-control">
      <h4>Pilih Basemap</h4>
      <select id="basemap-select">
        <option value="osm">üó∫Ô∏è OpenStreetMap</option>
        <option value="satellite">üõ∞Ô∏è Satelit</option>
        <option value="hybrid">üåç Hybrid (Satelit + Label)</option>
        <option value="terrain">üèîÔ∏è Terrain</option>
        <option value="carto-light">‚òÄÔ∏è Carto Light</option>
        <option value="carto-dark">üåô Carto Dark</option>
      </select>
      <div class="muted" style="margin-top: 8px; font-size: 11px">
        üí° Gunakan <b>Satelit</b> atau <b>Hybrid</b> untuk melihat detail
        geografis.
      </div>
    </div>

    <div id="map"></div>

    <div id="map-loading">
      <div class="loading-card">
        <div style="display: flex; align-items: center; gap: 10px">
          <i class="fa-solid fa-spinner fa-spin"></i>
          <div>
            <b>Memuat peta & data‚Ä¶</b>
            <div class="muted" style="font-size: 13px">
              Menyiapkan layer dan titik sumur
            </div>
          </div>
        </div>
        <div class="loading-lines">
          <div class="skeleton big"></div>
          <div class="skeleton"></div>
          <div class="skeleton"></div>
          <div class="skeleton"></div>
        </div>
      </div>
    </div>
    
    <script>
      (() => {
        const p = new URLSearchParams(location.search);
        const lat = parseFloat(p.get("lat"));
        const lng = parseFloat(p.get("lng"));
        const z = parseInt(p.get("z") || "17", 10);
        const id = p.get("id");

        if (Number.isFinite(lat) && Number.isFinite(lng)) {
          window.__MAP_TARGET__ = {
            lat,
            lng,
            z: Number.isFinite(z) ? z : 17,
            id,
          };
        }
      })();
    </script>

    <script src="script.js"></script>

    <script>
      const tabBtns = document.querySelectorAll(".tab-btn");
      const panels = document.querySelectorAll("[data-panel]");
      tabBtns.forEach((b) => {
        b.addEventListener("click", () => {
          tabBtns.forEach((x) => x.classList.remove("active"));
          b.classList.add("active");
          const key = b.getAttribute("data-tab");
          panels.forEach((p) => {
            const match = p.getAttribute("data-panel") === key;
            p.classList.toggle("hidden", !match);
          });
        });
      });
    </script>
  </body>
</html>